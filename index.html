<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>роЖро░рпЛроХрпНроХро┐роп рокропройрпНрокро╛роЯрпБ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Tamil:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* роЕроЯро┐рокрпНрокроЯрпИ UI рооро▒рпНро▒рпБроорпН роОро┤рпБродрпНродрпБро░рпБ рокро╛рогро┐роХро│рпН */
        body {
            font-family: 'Noto Sans Tamil', sans-serif;
            transition: background-color 0.5s ease;
            overflow-x: hidden;
            background-color: #f3f4f6;
        }

        /* SVG ро╡ро░рпИрокроЯродрпНродро┐ро▒рпНроХро╛рой рокро╛рогро┐роХро│рпН */
        .pain-map-svg .body-part:hover {
            fill: #4299e1;
            cursor: pointer;
            transition: fill 0.3s ease;
        }
        .pain-map-svg .body-part.pain {
            fill: #ef4444;
        }

        /* роиро┐ро▓рпИропро╛рой роЕроЯро┐роороЯрпНроЯ рокроЯрпНроЯро┐роХрпНроХро╛рой рокро╛рогро┐роХро│рпН */
        .fixed-bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        /* роорпБро┤рпБрокрпН рокроХрпНроХроорпБроорпН роиро┐ро░рокрпНрокро╡рпБроорпН, роЙро│рпН рокро╛роЯро┐-роЙро▒рпБрокрпНрокрпБроХро│рпИ роорпИропрокрпНрокроЯрпБродрпНродро╡рпБроорпН */
        #app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 1rem;
            padding-bottom: 5rem; /* Space for the bottom bar */
        }
        @media (min-width: 768px) {
            #app {
                justify-content: center;
            }
        }

        /* ро╡ро▓ро┐ ро╡ро░рпИрокроЯродрпНродро┐ро▒рпНроХро╛рой роорпКрокрпИро▓рпН-роЙроХроирпНрод рокро╛рогро┐роХро│рпН */
        .pain-map-container {
            width: 90%;
            max-width: 400px;
            height: auto;
            margin: 0 auto;
        }

        /* AI роЙродро╡ро┐роХрпНроХрпБро▒ро┐рокрпНрокрпБ рооро▒рпНро▒рпБроорпН роЪрпЖропрпНроорпБро▒рпИ рокрпЖроЯрпНроЯро┐роХро│рпБроХрпНроХро╛рой рокро╛рогро┐роХро│рпН */
        .output-box {
            width: 100%;
            padding: 1.5rem;
            background-color: #f3f4f6;
            border-radius: 1rem;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
            min-height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #4b5563;
            overflow-y: auto;
        }
        .output-box-container {
            position: relative;
            width: 100%;
        }
        .output-box-actions {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
        }

        /* роЪрпБро┤ро▓рпБроорпН ро╕рпНрокро┐ройрпНройро░рпН рокро╛рогро┐ */
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #4f46e5;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* роЪрпЖропрпНродро┐ рокрпЖроЯрпНроЯро┐ рокро╛рогро┐роХро│рпН */
        #message-box {
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 5000;
        }
        
        .login-bg {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            animation: backgroundShift 10s ease infinite alternate;
        }
        @keyframes backgroundShift {
            0% { background: linear-gradient(135deg, #f093fb, #f5576c); }
            25% { background: linear-gradient(135deg, #ffc796, #ff7176); }
            50% { background: linear-gradient(135deg, #a1c4fd, #c2e9fb); }
            75% { background: linear-gradient(135deg, #84fab0, #8fd3f4); }
            100% { background: linear-gradient(135deg, #f093fb, #f5576c); }
        }

        /* Login Card */
        .login-card {
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            max-width: 400px;
            width: 90%;
            padding: 2rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>
<body class="bg-gray-100 antialiased text-gray-800">

<div id="app" class="min-h-screen flex flex-col items-center justify-start p-4 md:p-8"></div>

<div id="bottom-bar" class="fixed-bottom-bar flex justify-center items-center gap-4 p-4 hidden"></div>

<div id="message-box" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center p-4 z-50">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
        <p class="text-lg font-medium text-gray-800 text-center" id="message-text"></p>
        <button onclick="closeMessageBox()" class="mt-4 w-full py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
            роЪро░ро┐
        </button>
    </div>
</div>

<script type="module">
    // роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБроХро│рпН
    const translations = {
        'ta': {
            loginTitle: 'ЁЯФТроЙро│рпНроирпБро┤рпИроХ',
            usernamePlaceholder: 'рокропройро░рпН рокрпЖропро░рпН',
            passwordPlaceholder: 'роХроЯро╡рпБроЪрпНроЪрпКро▓рпН',
            loginButton: 'роЙро│рпНроирпБро┤рпИроп',
            loginError: 'родропро╡рпБроЪрпЖропрпНродрпБ рокропройро░рпН рокрпЖропро░рпН рооро▒рпНро▒рпБроорпН роХроЯро╡рпБроЪрпНроЪрпКро▓рпНро▓рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН.',
            allFeaturesTitle: 'роЕройрпИродрпНродрпБ роЖро░рпЛроХрпНроХро┐роп роЕроорпНроЪроЩрпНроХро│рпН',
            backToFeatures: 'роЕроорпНроЪроЩрпНроХро│рпБроХрпНроХрпБ родро┐ро░рпБроорпНрокрпБ',
            featureNotDeveloped: 'роЗроирпНрод роЕроорпНроЪроорпН роЗройрпНройрпБроорпН роЙро░рпБро╡ро╛роХрпНроХрокрпНрокроЯро╡ро┐ро▓рпНро▓рпИ.',
            mainMenuTitle: 'роорпБроХрпНроХро┐роп роорпЖройрпБ',
            stepTracker: 'рокроЯро┐ роХрогрпНроХро╛рогро┐рокрпНрокрпБ',
            heartRate: 'роЗродропродрпН родрпБроЯро┐рокрпНрокрпБ',
            waterIntake: 'роирпАро░рпН роЙроЯрпНроХрпКро│рпНро│ро▓рпН',
            moodJournal: 'рооройроиро┐ро▓рпИ & роиройрпНро▒ро┐ропрпБрогро░рпНро╡рпБ роиро╛роЯрпНроХрпБро▒ро┐рокрпНрокрпБ',
            medicationReminder: 'рооро░рпБроирпНродрпБ роиро┐ройрпИро╡рпВроЯрпНроЯро▓рпН',
            foodPlan: 'роЙрогро╡рпБродрпН родро┐роЯрпНроЯроорпН',
            exerciseYoga: 'роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐ & ропрпЛроХро╛',
            bodyPainMap: 'роЙроЯро▓рпН ро╡ро▓ро┐ ро╡ро░рпИрокроЯроорпН',
            generalTips: 'рокрпКродрпБро╡ро╛рой роЪрпБроХро╛родро╛ро░ роХрпБро▒ро┐рокрпНрокрпБроХро│рпН',
            localTips: 'роЙро│рпНро│рпВро░рпН роЪрпБроХро╛родро╛ро░ роХрпБро▒ро┐рокрпНрокрпБроХро│рпН',
            beautyTips: 'ро╡рпАроЯрпНроЯрпБ роЕро┤роХрпБ роХрпБро▒ро┐рокрпНрокрпБроХро│рпН',
            symptomFinder: 'роЕро▒ро┐роХрпБро▒ро┐роХро│рпН роХрогрпНроЯрпБрокро┐роЯро┐рокрпНрокрпБ AI',
            firstAid: 'роорпБродро▓рпБродро╡ро┐ & роЕро╡роЪро░роорпН',
            foodRecipes: 'роЙрогро╡рпБ роЪрпЖропрпНроорпБро▒рпИроХро│рпН',
            search: 'родрпЗроЯрпБ',
            submit: 'роЪрооро░рпНрокрпНрокро┐',
            yourTipHere: 'роЙроЩрпНроХро│рпН роХрпБро▒ро┐рокрпНрокрпБ роЗроЩрпНроХрпЗ родрпЛройрпНро▒рпБроорпН.',
            noRecipe: 'роЪрпЖропрпНроорпБро▒рпИ роОродрпБро╡рпБроорпН роХро┐роЯрпИроХрпНроХро╡ро┐ро▓рпНро▓рпИ. роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН.',
            loadingMessage: 'AI роХрпБро▒ро┐рокрпНрокрпИ роЙро░рпБро╡ро╛роХрпНроХрпБроХро┐ро▒родрпБ...',
            inputPlaceholderGeneral: 'роирпАроЩрпНроХро│рпН ро╡ро┐ро░рпБроорпНрокрпБроорпН рокрпКродрпБро╡ро╛рой роЪрпБроХро╛родро╛ро░ роХрпБро▒ро┐рокрпНрокрпБроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.',
            inputPlaceholderBeauty: 'роирпАроЩрпНроХро│рпН ро╡ро┐ро░рпБроорпНрокрпБроорпН роЕро┤роХрпБ роХрпБро▒ро┐рокрпНрокрпБроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.',
            inputPlaceholderLocal: 'роирпАроЩрпНроХро│рпН ро╡ро┐ро░рпБроорпНрокрпБроорпН роЙро│рпНро│рпВро░рпН роЪрпБроХро╛родро╛ро░ роХрпБро▒ро┐рокрпНрокрпБроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.',
            inputPlaceholderSymptom: 'роЙроЩрпНроХро│рпН роЕро▒ро┐роХрпБро▒ро┐роХро│рпН рокро▒рпНро▒ро┐роп родроХро╡ро▓рпНроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.',
            inputPlaceholderRecipes: 'роТро░рпБ роЙрогро╡ро┐ройрпН рокрпЖропро░рпН роЕро▓рпНро▓родрпБ роорпВро▓рокрпНрокрпКро░рпБроЯрпНроХро│рпИ роЙро│рпНро│ро┐роЯрпНроЯрпБ роЪрпЖропрпНроорпБро▒рпИропрпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.',
            getTip: 'роХрпБро▒ро┐рокрпНрокрпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН',
            stepsCount: 'рокроЯро┐роХро│рпН: ',
            startTracking: 'роХрогрпНроХро╛рогро┐рокрпНрокрпИ родрпКроЯроЩрпНроХрпБ',
            stopTracking: 'роХрогрпНроХро╛рогро┐рокрпНрокрпИ роиро┐ро▒рпБродрпНродрпБ',
            reset: 'рокроЯро┐роХро│рпИ роорпАроЯрпНроЯроорпИ',
            stepMotivation: 'роТро░рпБ роиро╛ро│рпИроХрпНроХрпБ 10,000 рокроЯро┐роХро│рпН роироЯрокрпНрокродрпБ роЙроЩрпНроХро│рпН роЖро░рпЛроХрпНроХро┐ропродрпНродрпИ роХрогро┐роЪрооро╛роХ роорпЗроорпНрокроЯрпБродрпНродрпБроорпН.',
            journalPrompt: 'роЙроЩрпНроХро│рпН рооройроиро┐ро▓рпИропрпИропрпБроорпН, роирпАроЩрпНроХро│рпН роиройрпНро▒ро┐ропрпБро│рпНро│ ро╡ро┐ро╖ропроЩрпНроХро│рпИропрпБроорпН родро┐ройроорпБроорпН рокродро┐ро╡рпБ роЪрпЖропрпНропрпБроЩрпНроХро│рпН.',
            moodSelect: '-- рооройроиро┐ро▓рпИропрпИродрпН родрпЗро░рпНро╡рпБроЪрпЖропрпНропро╡рпБроорпН --',
            moodHappy: 'роороХро┐ро┤рпНроЪрпНроЪро┐',
            moodSad: 'роЪрпЛроХроорпН',
            moodNormal: 'роЪро╛родро╛ро░рогроорпН',
            moodAnxious: 'рокродроЯрпНроЯроорпН',
            moodGrateful: 'роиройрпНро▒ро┐ропрпБрогро░рпНро╡рпБ',
            saveEntry: 'рокродро┐ро╡рпИ роЪрпЗрооро┐',
            analyzeMood: 'рооройроиро┐ро▓рпИропрпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпН',
            moodAnalysis: 'рооройроиро┐ро▓рпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ',
            moodAnalysisPlaceholder: 'роЙроЩрпНроХро│рпН рооройроиро┐ро▓рпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЗроЩрпНроХрпЗ родрпЛройрпНро▒рпБроорпН.',
            yourEntries: 'роЙроЩрпНроХро│рпН рокродро┐ро╡рпБроХро│рпН',
            entriesPlaceholder: 'роЙроЩрпНроХро│рпН роиро╛роЯрпНроХрпБро▒ро┐рокрпНрокрпБ рокродро┐ро╡рпБроХро│рпН роЗроЩрпНроХрпЗ родрпЛройрпНро▒рпБроорпН.',
            foodPlanPrompt: 'роЙроЩрпНроХро│рпН роЙрогро╡рпБ, роЙроЯро▓рпНроиро▓роорпН, роТро╡рпНро╡ро╛роорпИ роЕро▓рпНро▓родрпБ рокро┐ро░роЪрпНроЪройрпИропрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН.',
            painMapPrompt: 'роЙроЯро▓ро┐ройрпН роОроирпНродрокрпН рокроХрпБродро┐ропро┐ро▓рпН ро╡ро▓ро┐ роЗро░рпБроХрпНроХро┐ро▒родрпЛ, роЕродрпИродрпН родрпКроЯрпНроЯрпБ ро╡ро▓ро┐ рооро▒рпНро▒рпБроорпН роЕродройрпН ро╡ро┐ро│роХрпНроХродрпНродрпИ роЪрпЗро░рпНроХрпНроХро╡рпБроорпН.',
            removePain: 'роирпАроЩрпНроХро│рпН роЕродрпИ роорпАрогрпНроЯрпБроорпН роЕро┤рпБродрпНродро┐ройро╛ро▓рпН ро╡ро▓ро┐ роирпАроХрпНроХрокрпНрокроЯрпБроорпН.',
            aiTipTitle: 'AI роЙродро╡ро┐роХрпНроХрпБро▒ро┐рокрпНрокрпБ',
            firstAidPrompt: 'роЕро╡роЪро░ роХро╛ро▓роЩрпНроХро│ро┐ро▓рпН роЙродро╡ро┐роХро│рпН рооро▒рпНро▒рпБроорпН родроХро╡ро▓рпНроХро│рпИ рокрпЖро▒ро╡рпБроорпН.',
            emergencyContacts: 'роЕро╡роЪро░ родрпКроЯро░рпНрокрпБроХро│рпН',
            addContact: 'родрпКроЯро░рпНрокрпИ роЪрпЗро░рпН',
            noContacts: 'роЕро╡роЪро░ родрпКроЯро░рпНрокрпБроХро│рпН роОродрпБро╡рпБроорпН роЗро▓рпНро▓рпИ.',
            symptomPrompt: 'роЙроЩрпНроХро│рпН роЕро▒ро┐роХрпБро▒ро┐роХро│рпН рокро▒рпНро▒ро┐роп родроХро╡ро▓рпНроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.',
            exercisePrompt: 'роЙроЩрпНроХро│рпН роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐, ро╡ро▓ро┐ роЕро▓рпНро▓родрпБ рокро┐ро░роЪрпНроЪройрпИроХрпНроХро╛рой ропрпЛроЪройрпИроХро│рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН.',
            painPromptPrefix: 'роЗроирпНрод роЙроЯро▒рпНрокроХрпБродро┐ ро╡ро▓ро┐роХрпНроХрпБ роХрпБро▒ро┐рокрпНрокрпБроХро│рпН:',
            painMapTipInstructions: 'ро╡ро▓ро┐ роЙро│рпНро│ рокроХрпБродро┐ропрпИродрпН родрпКроЯрпНроЯрпБ, роЕродройрпН рокро▒рпНро▒ро┐роп роХрпБро▒ро┐рокрпНрокрпБроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.',
            genericPainTip: 'роЙроЯро▓рпН ро╡ро▓ро┐роХрпНроХрпБ роХрпБро▒ро┐рокрпНрокрпБроХро│рпИрокрпН рокрпЖро▒ роТро░рпБ роЙроЯро▓рпН рокроХрпБродро┐ропрпИродрпН родрпКроЯро╡рпБроорпН.',
            micListening: 'роХрпЗроЯрпНроХро┐ро▒родрпБ...',
            micStopped: 'роорпИроХрпНро░рпЛроГрокрпЛройрпН роиро┐ро▒рпБродрпНродро┐ро╡ро┐роЯрпНроЯродрпБ.',
            speakTip: 'роХрпБро▒ро┐рокрпНрокрпИрокрпН рокрпЗроЪро╡рпБроорпН',
            stopSpeaking: 'рокрпЗроЪрпБро╡родрпИ роиро┐ро▒рпБродрпНродро╡рпБроорпН',
            motionSensorNotSupported: 'роЙроЩрпНроХро│рпН роЪро╛родройроорпН роорпЛро╖ройрпН роЪрпЖройрпНроЪро╛ро░рпИ роЖродро░ро┐роХрпНроХро╡ро┐ро▓рпНро▓рпИ. (Your device does not support motion sensors).',
            emergencyTip: 'роЕро╡роЪро░ роЙродро╡ро┐роХрпНроХрпБро▒ро┐рокрпНрокрпБ',
            viewFront: 'роорпБройрпНрокроХрпНроХ рокро╛ро░рпНро╡рпИ',
            viewBack: 'рокро┐ройрпНродро┐ро░рпБроорпНрокро┐роп рокро╛ро░рпНро╡рпИ',
            getRecipe: 'роЪрпЖропрпНроорпБро▒рпИропрпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН',
            ingredientsTitle: 'родрпЗро╡рпИропро╛рой рокрпКро░рпБроЯрпНроХро│рпН',
            instructionsTitle: 'роЪрпЖропрпНроорпБро▒рпИ',
            cookingTime: 'роЪроорпИропро▓рпН роирпЗро░роорпН',
        },
        'en': {
            loginTitle: 'ЁЯФТLogin',
            usernamePlaceholder: 'Username',
            passwordPlaceholder: 'Password',
            loginButton: 'Log In',
            loginError: 'Please enter a username and password.',
            allFeaturesTitle: 'All Health Features',
            backToFeatures: 'Back to Features',
            featureNotDeveloped: 'This feature is not yet developed.',
            mainMenuTitle: 'Main Menu',
            stepTracker: 'Step Tracker',
            heartRate: 'Heart Rate',
            waterIntake: 'Water Intake',
            moodJournal: 'Mood & Gratitude Journal',
            medicationReminder: 'Medication Reminder',
            foodPlan: 'Food Plan',
            exerciseYoga: 'Exercise & Yoga',
            bodyPainMap: 'Body Pain Map',
            generalTips: 'General Health Tips',
            localTips: 'Local Health Tips',
            beautyTips: 'Home Beauty Tips',
            symptomFinder: 'Symptom Finder AI',
            firstAid: 'First Aid & Emergency',
            foodRecipes: 'Food Recipes',
            search: 'Search',
            submit: 'Submit',
            yourTipHere: 'Your tip will appear here.',
            noRecipe: 'No recipe available. Please try again.',
            loadingMessage: 'Generating AI tip...',
            inputPlaceholderGeneral: 'Get the general health tips you want.',
            inputPlaceholderBeauty: 'Get the beauty tips you want.',
            inputPlaceholderLocal: 'Get the local health tips you want.',
            inputPlaceholderSymptom: 'Get information about your symptoms.',
            inputPlaceholderRecipes: 'Enter a food name or ingredients to get the recipe.',
            getTip: 'Get Tips',
            stepsCount: 'Steps: ',
            startTracking: 'Start Tracking',
            stopTracking: 'Stop Tracking',
            reset: 'Reset Steps',
            stepMotivation: 'Walking 10,000 steps a day can significantly improve your health.',
            journalPrompt: 'Record your mood and things you are grateful for daily.',
            moodSelect: '-- Select a mood --',
            moodHappy: 'Happy',
            moodSad: 'Sad',
            moodNormal: 'Normal',
            moodAnxious: 'Anxious',
            moodGrateful: 'Grateful',
            saveEntry: 'Save Entry',
            analyzeMood: 'Analyze Mood',
            moodAnalysis: 'Mood Analysis',
            moodAnalysisPlaceholder: 'Your mood analysis will appear here.',
            yourEntries: 'Your Entries',
            entriesPlaceholder: 'Your journal entries will appear here.',
            foodPlanPrompt: 'Enter your diet, health, allergy or problem.',
            painMapPrompt: 'Touch the area of your body where you have pain to add the pain and its description.',
            removePain: 'You can touch it again to remove the pain.',
            aiTipTitle: 'AI Tip',
            firstAidPrompt: 'Get help and information in emergencies.',
            emergencyContacts: 'Emergency Contacts',
            addContact: 'Add Contact',
            noContacts: 'No emergency contacts added.',
            symptomPrompt: 'Get information about your symptoms.',
            exercisePrompt: 'Enter your exercise, pain or problem for ideas.',
            painPromptPrefix: 'Tips for this body part pain:',
            painMapTipInstructions: 'Touch a painful area to get tips about it.',
            genericPainTip: 'Touch a body part to get tips for pain in that area.',
            micListening: 'Listening...',
            micStopped: 'Microphone stopped.',
            speakTip: 'Speak Tip',
            stopSpeaking: 'Stop Speaking',
            motionSensorNotSupported: 'Your device does not support motion sensors.',
            emergencyTip: 'Emergency Tip',
            viewFront: 'Front View',
            viewBack: 'Back View',
            getRecipe: 'Get Recipe',
            ingredientsTitle: 'Ingredients',
            instructionsTitle: 'Instructions',
            cookingTime: 'Cooking Time',
        }
    };
    
    // рокрпБродрпБрокрпНрокро┐роХрпНроХрокрпНрокроЯрпНроЯ роЕроорпНроЪроЩрпНроХро│рпН рокроЯрпНроЯро┐ропро▓рпН
    const features = [
        { id: 'stepTracker', icon: 'fa-walking', titleKey: 'stepTracker', color: 'bg-green-500' },
        { id: 'generalTips', icon: 'fa-lightbulb', titleKey: 'generalTips', color: 'bg-yellow-500' },
        { id: 'symptomFinder', icon: 'fa-stethoscope', titleKey: 'symptomFinder', color: 'bg-blue-500' },
        { id: 'firstAid', icon: 'fa-hand-holding-medical', titleKey: 'firstAid', color: 'bg-red-500' },
        { id: 'localTips', icon: 'fa-seedling', titleKey: 'localTips', color: 'bg-lime-500' },
        { id: 'foodPlan', icon: 'fa-apple-alt', titleKey: 'foodPlan', color: 'bg-orange-500' },
        { id: 'foodRecipes', icon: 'fa-utensils', titleKey: 'foodRecipes', color: 'bg-amber-500' },
        { id: 'beautyTips', icon: 'fa-spa', titleKey: 'beautyTips', color: 'bg-pink-500' },
        { id: 'exerciseYoga', icon: 'fa-running', titleKey: 'exerciseYoga', color: 'bg-indigo-500' },
        { id: 'bodyPainMap', icon: 'fa-user-injured', titleKey: 'bodyPainMap', color: 'bg-purple-500' },
        { id: 'moodJournal', icon: 'fa-grin-hearts', titleKey: 'moodJournal', color: 'bg-sky-500' },
    ];

    // Mapping from SVG part IDs to human-readable names for AI prompt generation
    const painMapPartNames = {
        'head-front': { ta: 'родро▓рпИ', en: 'head' },
        'neck-front': { ta: 'роХро┤рпБродрпНродрпБ', en: 'neck' },
        'chest': { ta: 'рооро╛ро░рпНрокрпБ', en: 'chest' },
        'stomach': { ta: 'ро╡ропро┐ро▒рпБ', en: 'stomach' },
        'shoulder-r-front': { ta: 'ро╡ро▓родрпБ родрпЛро│рпНрокроЯрпНроЯрпИ', en: 'right shoulder' },
        'shoulder-l-front': { ta: 'роЗроЯродрпБ родрпЛро│рпНрокроЯрпНроЯрпИ', en: 'left shoulder' },
        'arm-r-front': { ta: 'ро╡ро▓родрпБ роХрпИ', en: 'right arm' },
        'arm-l-front': { ta: 'роЗроЯродрпБ роХрпИ', en: 'left arm' },
        'elbow-r-front': { ta: 'ро╡ро▓родрпБ роорпБро┤роЩрпНроХрпИ', en: 'right elbow' },
        'elbow-l-front': { ta: 'роЗроЯродрпБ роорпБро┤роЩрпНроХрпИ', en: 'left elbow' },
        'forearm-r-front': { ta: 'ро╡ро▓родрпБ роорпБройрпНроХрпИ', en: 'right forearm' },
        'forearm-l-front': { ta: 'роЗроЯродрпБ роорпБройрпНроХрпИ', en: 'left forearm' },
        'hand-r-front': { ta: 'ро╡ро▓родрпБ роХрпИ', en: 'right hand' },
        'hand-l-front': { ta: 'роЗроЯродрпБ роХрпИ', en: 'left hand' },
        'waist-front': { ta: 'роЗроЯрпБрокрпНрокрпБ', en: 'waist' },
        'thigh-r-front': { ta: 'ро╡ро▓родрпБ родрпКроЯрпИ', en: 'right thigh' },
        'thigh-l-front': { ta: 'роЗроЯродрпБ родрпКроЯрпИ', en: 'left thigh' },
        'knee-r-front': { ta: 'ро╡ро▓родрпБ роорпБро┤роЩрпНроХро╛ро▓рпН', en: 'right knee' },
        'knee-l-front': { ta: 'роЗроЯродрпБ роорпБро┤роЩрпНроХро╛ро▓рпН', en: 'left knee' },
        'shin-r-front': { ta: 'ро╡ро▓родрпБ роХро╛ро▓рпН', en: 'right shin' },
        'shin-l-front': { ta: 'роЗроЯродрпБ роХро╛ро▓рпН', en: 'left shin' },
        'ankle-r-front': { ta: 'ро╡ро▓родрпБ роХрогрпБроХрпНроХро╛ро▓рпН', en: 'right ankle' },
        'ankle-l-front': { ta: 'роЗроЯродрпБ роХрогрпБроХрпНроХро╛ро▓рпН', en: 'left ankle' },
        'foot-r-front': { ta: 'ро╡ро▓родрпБ рокро╛родроорпН', en: 'right foot' },
        'foot-l-front': { ta: 'роЗроЯродрпБ рокро╛родроорпН', en: 'left foot' },

        // Back View
        'head-back': { ta: 'родро▓рпИ', en: 'head' },
        'neck-back': { ta: 'роХро┤рпБродрпНродрпБ', en: 'neck' },
        'back': { ta: 'роорпБродрпБроХрпБ', en: 'back' },
        'buttocks': { ta: 'рокро┐роЯрпНроЯроорпН', en: 'buttocks' },
        'shoulder-r-back': { ta: 'ро╡ро▓родрпБ родрпЛро│рпНрокроЯрпНроЯрпИ', en: 'right shoulder' },
        'shoulder-l-back': { ta: 'роЗроЯродрпБ родрпЛро│рпНрокроЯрпНроЯрпИ', en: 'left shoulder' },
        'arm-r-back': { ta: 'ро╡ро▓родрпБ роХрпИ', en: 'right arm' },
        'arm-l-back': { ta: 'роЗроЯродрпБ роХрпИ', en: 'left arm' },
        'elbow-r-back': { ta: 'ро╡ро▓родрпБ роорпБро┤роЩрпНроХрпИ', en: 'right elbow' },
        'elbow-l-back': { ta: 'роЗроЯродрпБ роорпБро┤роЩрпНроХрпИ', en: 'left elbow' },
        'forearm-r-back': { ta: 'ро╡ро▓родрпБ роорпБройрпНроХрпИ', en: 'right forearm' },
        'forearm-l-back': { ta: 'роЗроЯродрпБ роорпБройрпНроХрпИ', en: 'left forearm' },
        'hand-r-back': { ta: 'ро╡ро▓родрпБ роХрпИ', en: 'right hand' },
        'hand-l-back': { ta: 'роЗроЯродрпБ роХрпИ', en: 'left hand' },
        'waist-back': { ta: 'роЗроЯрпБрокрпНрокрпБ', en: 'waist' },
        'thigh-r-back': { ta: 'ро╡ро▓родрпБ родрпКроЯрпИ', en: 'right thigh' },
        'thigh-l-back': { ta: 'роЗроЯродрпБ родрпКроЯрпИ', en: 'left thigh' },
        'knee-r-back': { ta: 'ро╡ро▓родрпБ роорпБро┤роЩрпНроХро╛ро▓рпН', en: 'right knee' },
        'knee-l-back': { ta: 'роЗроЯродрпБ роорпБро┤роЩрпНроХро╛ро▓рпН', en: 'left knee' },
        'calf-r-back': { ta: 'ро╡ро▓родрпБ роХройрпНро▒рпБ', en: 'right calf' },
        'calf-l-back': { ta: 'роЗроЯродрпБ роХройрпНро▒рпБ', en: 'left calf' },
        'ankle-r-back': { ta: 'ро╡ро▓родрпБ роХрогрпБроХрпНроХро╛ро▓рпН', en: 'right ankle' },
        'ankle-l-back': { ta: 'роЗроЯродрпБ роХрогрпБроХрпНроХро╛ро▓рпН', en: 'left ankle' },
        'foot-r-back': { ta: 'ро╡ро▓родрпБ рокро╛родроорпН', en: 'right foot' },
        'foot-l-back': { ta: 'роЗроЯродрпБ рокро╛родроорпН', en: 'left foot' },
    };

    let currentPage = 'login';
    let currentLang = 'ta';
    let steps = 0;
    let isTracking = false;
    let lastAcceleration = { x: 0, y: 0, z: 0 };
    const stepThreshold = 1.2; // Adjusted threshold for better step detection
    let stepCooldown = false;
    let cooldownTimer = null;
    let stepTrackerHandler = null;
    const moodEntries = [];
    const foodPlan = [];
    const emergencyContacts = [];
    const painMapState = {};
    let isFrontView = true;

    const getTranslation = (key) => translations[currentLang][key] || key;
    const appContainer = document.getElementById('app');
    const bottomBar = document.getElementById('bottom-bar');
    const messageBox = document.getElementById('message-box');
    const messageText = document.getElementById('message-text');

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const synth = window.speechSynthesis;

    let recognition = null;
    let isListening = false;
    let isSpeaking = false;

    function showMessageBox(message) {
        messageText.textContent = message;
        messageBox.classList.remove('hidden');
        messageBox.classList.add('flex');
    }

    function closeMessageBox() {
        messageBox.classList.add('hidden');
        messageBox.classList.remove('flex');
    }

    const toggleSpeechRecognition = (inputElementId, buttonElement) => {
        const aiTipElement = document.getElementById('tipOutput') || document.getElementById('recipeOutput');
        const input = document.getElementById(inputElementId);

        if (!SpeechRecognition) {
            showMessageBox('роЙроЩрпНроХро│рпН роЙро▓ро╛ро╡ро┐ рокрпЗроЪрпНроЪрпБ роЕроЩрпНроХрпАроХро╛ро░родрпНродрпИ роЖродро░ро┐роХрпНроХро╡ро┐ро▓рпНро▓рпИ. (Your browser does not support Speech Recognition).');
            return;
        }

        if (isListening) {
            recognition.stop();
            isListening = false;
            buttonElement.innerHTML = '<i class="fas fa-microphone"></i>';
            if (aiTipElement) {
                aiTipElement.textContent = getTranslation('micStopped');
            }
        } else {
            recognition = new SpeechRecognition();
            recognition.lang = currentLang === 'ta' ? 'ta-IN' : 'en-US';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.onstart = () => {
                isListening = true;
                buttonElement.innerHTML = '<i class="fas fa-microphone-slash"></i>';
                if (aiTipElement) {
                    aiTipElement.textContent = getTranslation('micListening');
                }
            };

            recognition.onresult = (event) => {
                const speechResult = event.results[0][0].transcript;
                if (input) {
                    input.value = speechResult;
                }
                if (aiTipElement) {
                    aiTipElement.textContent = '';
                }
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error', event.error);
                showMessageBox(`рокрпЗроЪрпНроЪрпБ роЕроЩрпНроХрпАроХро╛ро░роорпН рокро┐ро┤рпИ: ${event.error}. (Speech recognition error: ${event.error})`);
            };

            recognition.onend = () => {
                isListening = false;
                buttonElement.innerHTML = '<i class="fas fa-microphone"></i>';
                if (aiTipElement && aiTipElement.textContent === getTranslation('micListening')) {
                    aiTipElement.textContent = '';
                }
            };

            recognition.start();
        }
    };

    const toggleSpeak = (text, buttonElement) => {
        if (!synth) {
            showMessageBox('роЙроЩрпНроХро│рпН роЙро▓ро╛ро╡ро┐ рокрпЗроЪрпНроЪрпБ родрпКроХрпБрокрпНрокрпИ роЖродро░ро┐роХрпНроХро╡ро┐ро▓рпНро▓рпИ. (Your browser does not support speech synthesis).');
            return;
        }

        if (isSpeaking) {
            synth.cancel();
            isSpeaking = false;
            buttonElement.innerHTML = '<i class="fas fa-volume-up"></i>';
        } else {
            if (!text || text.trim() === getTranslation('yourTipHere') || text.trim() === getTranslation('noRecipe') || text.trim() === getTranslation('loadingMessage')) {
                showMessageBox('рокрпЗроЪ роОродрпБро╡рпБроорпН роЗро▓рпНро▓рпИ.');
                return;
            }

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = currentLang === 'ta' ? 'ta-IN' : 'en-US';

            utterance.onstart = () => {
                isSpeaking = true;
                buttonElement.innerHTML = '<i class="fas fa-volume-mute"></i>';
            };

            utterance.onend = () => {
                isSpeaking = false;
                buttonElement.innerHTML = '<i class="fas fa-volume-up"></i>';
            };

            synth.speak(utterance);
        }
    };
    
    // Function to parse and format general AI tips
    const parseTipsAsList = (tipText) => {
        const lines = tipText.split('\n').filter(line => line.trim() !== '');
        
        let html = '';
        if (lines.length > 1) {
            html += '<ol class="list-decimal list-inside space-y-2 mt-4 text-left">';
            lines.forEach(line => {
                const cleanedLine = line.replace(/^\s*(\d+\.|\*|-)\s*/, '').trim();
                if (cleanedLine) {
                    html += `<li class="text-gray-700">${cleanedLine}</li>`;
                }
            });
            html += '</ol>';
        } else {
            html = `<p class="text-gray-700 mt-4 text-center">${tipText}</p>`;
        }
        return html;
    };

    // New function to parse and format AI recipes from JSON
    const parseRecipe = (recipe) => {
        let html = '';

        if (!recipe || !recipe.ingredients || !recipe.instructions) {
            html = `<p class="text-gray-700 mt-4 text-center">${getTranslation('noRecipe')}</p>`;
            return html;
        }

        html += `<h2 class="text-2xl font-bold mt-4 mb-2 text-gray-800">${recipe.recipeName || 'роЪрпЖропрпНроорпБро▒рпИ'}</h2>`;
        
        if (recipe.cookingTime) {
            html += `<p class="text-md text-gray-600 mb-4"><i class="fas fa-clock mr-2"></i>${getTranslation('cookingTime')}: ${recipe.cookingTime}</p>`;
        }
        
        // Ingredients
        html += `<h3 class="text-xl font-bold mt-4 mb-2 text-gray-800">${getTranslation('ingredientsTitle')}</h3>`;
        html += '<ul class="list-disc list-inside space-y-1 text-left">';
        recipe.ingredients.forEach(line => {
            html += `<li class="text-gray-700">${line.trim()}</li>`;
        });
        html += '</ul>';
        
        // Instructions
        html += `<h3 class="text-xl font-bold mt-4 mb-2 text-gray-800">${getTranslation('instructionsTitle')}</h3>`;
        html += '<ol class="list-decimal list-inside space-y-2 text-left">';
        recipe.instructions.forEach(line => {
            html += `<li class="text-gray-700">${line.trim()}</li>`;
        });
        html += '</ol>';

        return html;
    };

    const getAiTipFromPrompt = async (prompt, outputId) => {
        const outputElement = document.getElementById(outputId);
        outputElement.innerHTML = `<div class="loading-spinner"></div> <span class="ml-2">${getTranslation('loadingMessage')}</span>`;

        const finalPrompt = `${prompt}
Please provide a response in ${currentLang === 'ta' ? 'Tamil' : 'English'}. Format the response as a detailed, step-by-step numbered list. Add some relevant emojis for each step. Do not include any introductory or concluding sentences outside of the list.`;

        try {
            const chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: finalPrompt }] });
            const payload = { contents: chatHistory };

            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`API call failed with status: ${response.status}. Message: ${errorData.error.message}`);
            }

            const result = await response.json();

            let tipText = getTranslation('yourTipHere');
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                tipText = result.candidates[0].content.parts[0].text;
            } else {
                tipText = getTranslation('noRecipe');
            }

            outputElement.innerHTML = parseTipsAsList(tipText);
        } catch (error) {
            console.error('Error generating AI tip:', error);
            outputElement.innerHTML = `<p class="text-red-500 text-center">роЙродро╡ро┐роХрпНроХрпБро▒ро┐рокрпНрокрпИ роЙро░рпБро╡ро╛роХрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ: ${error.message}</p>`;
        }
    };
    
    // New function to get a recipe from AI using structured JSON output
    const getAiRecipeFromPrompt = async (prompt, outputId) => {
        const outputElement = document.getElementById(outputId);
        outputElement.innerHTML = `<div class="loading-spinner"></div> <span class="ml-2">${getTranslation('loadingMessage')}</span>`;

        // Create a specific prompt for recipes, requesting ingredients and instructions
        const recipePrompt = `Please generate a recipe for "${prompt}". Include the recipe name, approximate cooking time, a list of ingredients, and a step-by-step list of instructions. Provide the response as a JSON object. The recipe should be in ${currentLang === 'ta' ? 'Tamil' : 'English'}.`;

        try {
            const chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: recipePrompt }] });
            const payload = {
                contents: chatHistory,
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            "recipeName": { "type": "STRING" },
                            "cookingTime": { "type": "STRING" },
                            "ingredients": { "type": "ARRAY", "items": { "type": "STRING" } },
                            "instructions": { "type": "ARRAY", "items": { "type": "STRING" } }
                        }
                    }
                }
            };
            
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`API call failed with status: ${response.status}. Message: ${errorData.error.message}`);
            }

            const result = await response.json();
            let recipeData = null;
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                const jsonText = result.candidates[0].content.parts[0].text;
                try {
                    recipeData = JSON.parse(jsonText);
                } catch (jsonError) {
                    console.error('JSON parse error:', jsonError);
                }
            }
            
            outputElement.innerHTML = parseRecipe(recipeData);

        } catch (error) {
            console.error('Error generating AI recipe:', error);
            outputElement.innerHTML = `<p class="text-red-500 text-center">роЪрпЖропрпНроорпБро▒рпИропрпИ роЙро░рпБро╡ро╛роХрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ: ${error.message}</p>`;
        }
    };

    const render = () => {
        appContainer.innerHTML = '';
        bottomBar.innerHTML = '';
        bottomBar.classList.add('hidden');
        document.body.classList.remove('login-bg');

        // Stop the motion sensor listener before rendering a new page
        if (stepTrackerHandler) {
            window.removeEventListener('devicemotion', stepTrackerHandler);
            stepTrackerHandler = null;
            isTracking = false;
        }

        switch (currentPage) {
            case 'login':
                document.body.classList.add('login-bg');
                renderLoginPage();
                break;
            case 'main':
                renderMainPage();
                break;
            case 'stepTracker':
                renderStepTrackerPage();
                renderBottomBar();
                break;
            case 'moodJournal':
                renderMoodJournalPage();
                renderBottomBar();
                break;
            case 'foodRecipes':
                renderFoodRecipesPage();
                renderBottomBar();
                break;
            case 'bodyPainMap':
                renderBodyPainMapPage();
                renderBottomBar();
                break;
            case 'firstAid':
                renderFirstAidPage();
                renderBottomBar();
                break;
            case 'exerciseYoga':
            case 'beautyTips':
            case 'generalTips':
            case 'localTips':
            case 'symptomFinder':
            case 'foodPlan':
                const featureTitle = getTranslation(currentPage);
                let placeholderKey = currentPage === 'foodPlan' ? 'foodPlanPrompt' : (currentPage === 'exerciseYoga' ? 'exercisePrompt' : `inputPlaceholder${currentPage.charAt(0).toUpperCase() + currentPage.slice(1)}`);
                if (!translations[currentLang][placeholderKey]) {
                    placeholderKey = 'yourTipHere';
                }
                renderAiTipsPage(featureTitle, getTranslation(placeholderKey), currentPage);
                renderBottomBar();
                break;
            default:
                renderSimplePage(getTranslation('featureNotDeveloped'), 'ЁЯЪл', '');
                break;
        }
    };

    const navigateTo = (page) => {
        currentPage = page;
        render();
    };

    const toggleLanguage = () => {
        currentLang = currentLang === 'ta' ? 'en' : 'ta';
        render();
    };

    const renderLoginPage = () => {
        appContainer.innerHTML = `
            <div class="login-card flex flex-col items-center">
                <div class="w-full flex justify-end">
                    <button id="lang-toggle-btn" class="text-gray-600 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-300 rounded-full p-2">
                        <i class="fas fa-globe text-xl"></i>
                    </button>
                </div>
                <h1 class="text-3xl font-bold mb-6 text-gray-900">${getTranslation('loginTitle')}</h1>
                <div class="w-full space-y-4">
                    <input type="text" id="username" class="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="${getTranslation('usernamePlaceholder')}">
                    <div class="relative w-full">
                        <input type="password" id="password" class="w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 pr-12" placeholder="${getTranslation('passwordPlaceholder')}">
                        <span id="toggle-password" class="absolute inset-y-0 right-0 pr-4 flex items-center cursor-pointer text-gray-500 hover:text-gray-700">
                            <i class="fas fa-eye"></i>
                        </span>
                    </div>
                </div>
                <button id="login-btn" class="w-full mt-6 py-4 px-6 bg-indigo-600 text-white font-bold rounded-xl shadow-lg hover:bg-indigo-700 transition-colors duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-indigo-300">
                    ${getTranslation('loginButton')}
                </button>
            </div>
        `;

        document.getElementById('lang-toggle-btn').addEventListener('click', toggleLanguage);
        document.getElementById('login-btn').addEventListener('click', () => {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            if (username && password) {
                navigateTo('main');
            } else {
                showMessageBox(getTranslation('loginError'));
            }
        });

        const passwordInput = document.getElementById('password');
        const togglePassword = document.getElementById('toggle-password');
        togglePassword.addEventListener('click', () => {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            togglePassword.querySelector('i').classList.toggle('fa-eye');
            togglePassword.querySelector('i').classList.toggle('fa-eye-slash');
        });
    };

    const renderMainPage = () => {
        appContainer.innerHTML = `
            <h1 class="text-4xl font-extrabold mb-8 text-center text-gray-900">${getTranslation('allFeaturesTitle')}</h1>
            <div class="grid grid-cols-2 sm:grid-cols-3 gap-6 w-full max-w-4xl">
                ${features.map(f => `
                    <button onclick="navigateTo('${f.id}')" class="flex flex-col items-center justify-center p-6 bg-white rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:scale-105 cursor-pointer">
                        <div class="w-16 h-16 ${f.color} rounded-full flex items-center justify-center mb-3">
                            <i class="fas ${f.icon} text-2xl text-white"></i>
                        </div>
                        <span class="text-center font-semibold text-gray-700">${getTranslation(f.titleKey)}</span>
                    </button>
                `).join('')}
            </div>
        `;
    };

    const renderBottomBar = () => {
        bottomBar.classList.remove('hidden');
        bottomBar.classList.add('flex');
        bottomBar.innerHTML = `
            <button onclick="navigateTo('main')" class="flex flex-col items-center text-gray-600 hover:text-indigo-600 transition-colors duration-200">
                <i class="fas fa-home text-2xl"></i>
                <span class="text-xs mt-1">${getTranslation('mainMenuTitle')}</span>
            </button>
            <button onclick="navigateTo('login')" class="flex flex-col items-center text-gray-600 hover:text-indigo-600 transition-colors duration-200">
                <i class="fas fa-sign-out-alt text-2xl"></i>
                <span class="text-xs mt-1">Log Out</span>
            </button>
            <button onclick="toggleLanguage()" class="flex flex-col items-center text-gray-600 hover:text-indigo-600 transition-colors duration-200">
                <i class="fas fa-globe text-2xl"></i>
                <span class="text-xs mt-1">${currentLang === 'ta' ? 'English' : 'родрооро┐ро┤рпН'}</span>
            </button>
        `;
    };

    const renderSimplePage = (title, icon, content) => {
        appContainer.innerHTML = `
            <h1 class="text-4xl font-extrabold mb-8 text-center text-gray-900">${icon} ${title}</h1>
            <p class="text-lg text-gray-600 text-center max-w-lg">${content}</p>
        `;
    };

    const renderAiTipsPage = (title, placeholder, featureId) => {
        appContainer.innerHTML = `
            <h1 class="text-3xl font-bold mb-6 text-center text-gray-900">${title}</h1>
            <p class="text-lg text-gray-600 mb-6 text-center">${placeholder}</p>
            <div class="w-full max-w-2xl flex flex-col md:flex-row items-center gap-4 mb-6">
                <input type="text" id="tipInput" class="flex-1 w-full p-4 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="${placeholder}">
                <div class="flex gap-2 w-full md:w-auto">
                    <button id="getTipBtn" class="flex-1 md:flex-auto px-6 py-4 bg-indigo-600 text-white font-bold rounded-lg shadow-md hover:bg-indigo-700 transition-colors">
                        ${getTranslation('getTip')}
                    </button>
                    <button id="mic-btn" class="px-4 py-4 bg-gray-200 text-gray-600 rounded-lg hover:bg-gray-300 transition-colors">
                        <i class="fas fa-microphone"></i>
                    </button>
                </div>
            </div>
            <div id="tipOutput" class="output-box-container w-full max-w-2xl mt-4 relative">
                <div class="output-box">
                    <p class="text-gray-400">${getTranslation('yourTipHere')}</p>
                </div>
                <div class="output-box-actions">
                    <button id="speak-btn" class="p-2 bg-gray-200 text-gray-600 rounded-full hover:bg-gray-300 transition-colors">
                        <i class="fas fa-volume-up"></i>
                    </button>
                </div>
            </div>
        `;
        document.getElementById('getTipBtn').addEventListener('click', () => {
            const input = document.getElementById('tipInput').value.trim();
            if (input) {
                getAiTipFromPrompt(input, 'tipOutput');
            } else {
                showMessageBox(getTranslation('inputPlaceholderGeneral'));
            }
        });

        document.getElementById('mic-btn').addEventListener('click', (e) => toggleSpeechRecognition('tipInput', e.currentTarget));
        document.getElementById('speak-btn').addEventListener('click', (e) => {
            const textToSpeak = document.getElementById('tipOutput').textContent.trim();
            toggleSpeak(textToSpeak, e.currentTarget);
        });
    };

    const renderStepTrackerPage = () => {
        appContainer.innerHTML = `
            <div class="w-full max-w-md flex flex-col items-center justify-center p-6 bg-white rounded-2xl shadow-xl transition-all duration-300">
                <h1 class="text-3xl font-bold mb-4 text-center text-gray-900">${getTranslation('stepTracker')}</h1>
                <p class="text-gray-600 mb-6 text-center">${getTranslation('stepMotivation')}</p>
                <div class="relative w-48 h-48 mb-6">
                    <div class="absolute inset-0 rounded-full bg-blue-100 flex items-center justify-center">
                        <div class="absolute inset-2 rounded-full bg-white flex items-center justify-center shadow-inner">
                            <span id="steps-count" class="text-5xl font-extrabold text-blue-600">${steps}</span>
                        </div>
                    </div>
                </div>
                <div class="flex gap-4 w-full justify-center">
                    <button id="toggle-tracking-btn" class="px-6 py-3 bg-green-500 text-white font-semibold rounded-full shadow-md hover:bg-green-600 transition-colors flex-1 text-sm">
                        ${isTracking ? getTranslation('stopTracking') : getTranslation('startTracking')}
                    </button>
                    <button id="reset-btn" class="px-6 py-3 bg-gray-200 text-gray-700 font-semibold rounded-full shadow-md hover:bg-gray-300 transition-colors flex-1 text-sm">
                        ${getTranslation('reset')}
                    </button>
                </div>
            </div>
        `;

        const updateSteps = () => {
            const stepsElement = document.getElementById('steps-count');
            if (stepsElement) {
                stepsElement.textContent = steps;
            }
        };

        const handleDeviceMotion = (event) => {
            const acceleration = event.accelerationIncludingGravity;
            const diff = Math.sqrt(
                (acceleration.x - lastAcceleration.x) ** 2 +
                (acceleration.y - lastAcceleration.y) ** 2 +
                (acceleration.z - lastAcceleration.z) ** 2
            );

            if (diff > stepThreshold && !stepCooldown) {
                steps++;
                updateSteps();
                stepCooldown = true;
                if (cooldownTimer) clearTimeout(cooldownTimer);
                cooldownTimer = setTimeout(() => {
                    stepCooldown = false;
                }, 500);
            }
            lastAcceleration = acceleration;
        };

        const toggleTracking = () => {
            const toggleButton = document.getElementById('toggle-tracking-btn');
            if (isTracking) {
                window.removeEventListener('devicemotion', stepTrackerHandler);
                isTracking = false;
                toggleButton.textContent = getTranslation('startTracking');
                toggleButton.classList.remove('bg-red-500', 'hover:bg-red-600');
                toggleButton.classList.add('bg-green-500', 'hover:bg-green-600');
            } else {
                if (typeof DeviceMotionEvent.requestPermission === 'function') {
                    DeviceMotionEvent.requestPermission().then(permissionState => {
                        if (permissionState === 'granted') {
                            startTrackingLogic(toggleButton);
                        } else {
                            showMessageBox(getTranslation('motionSensorNotSupported'));
                        }
                    }).catch(console.error);
                } else {
                    startTrackingLogic(toggleButton);
                }
            }
        };

        const startTrackingLogic = (toggleButton) => {
            stepTrackerHandler = handleDeviceMotion;
            window.addEventListener('devicemotion', stepTrackerHandler);
            isTracking = true;
            toggleButton.textContent = getTranslation('stopTracking');
            toggleButton.classList.remove('bg-green-500', 'hover:bg-green-600');
            toggleButton.classList.add('bg-red-500', 'hover:bg-red-600');
        };

        document.getElementById('toggle-tracking-btn').addEventListener('click', toggleTracking);
        document.getElementById('reset-btn').addEventListener('click', () => {
            steps = 0;
            updateSteps();
        });

        // Initial update for steps count
        updateSteps();
    };

    const renderMoodJournalPage = () => {
        appContainer.innerHTML = `
            <div class="w-full max-w-2xl flex flex-col items-center p-6 bg-white rounded-2xl shadow-xl transition-all duration-300">
                <h1 class="text-3xl font-bold mb-4 text-center text-gray-900">${getTranslation('moodJournal')}</h1>
                <p class="text-gray-600 mb-6 text-center">${getTranslation('journalPrompt')}</p>
                <div class="w-full space-y-4">
                    <div class="flex flex-col sm:flex-row items-center gap-4">
                        <select id="mood-select" class="w-full sm:w-1/2 p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="">${getTranslation('moodSelect')}</option>
                            <option value="happy">${getTranslation('moodHappy')} ЁЯШК</option>
                            <option value="sad">${getTranslation('moodSad')} ЁЯШв</option>
                            <option value="normal">${getTranslation('moodNormal')} ЁЯШР</option>
                            <option value="anxious">${getTranslation('moodAnxious')} ЁЯШм</option>
                            <option value="grateful">${getTranslation('moodGrateful')} ЁЯЩП</option>
                        </select>
                        <textarea id="journal-entry" class="w-full sm:w-1/2 p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="3" placeholder="${getTranslation('yourEntries')}"></textarea>
                    </div>
                    <button id="save-btn" class="w-full py-4 px-6 bg-indigo-600 text-white font-bold rounded-xl shadow-lg hover:bg-indigo-700 transition-colors">
                        ${getTranslation('saveEntry')}
                    </button>
                    <button id="analyze-btn" class="w-full py-4 px-6 bg-teal-500 text-white font-bold rounded-xl shadow-lg hover:bg-teal-600 transition-colors">
                        ${getTranslation('analyzeMood')}
                    </button>
                </div>
                <div id="analysis-output" class="output-box w-full mt-6">
                    <p class="text-gray-400">${getTranslation('moodAnalysisPlaceholder')}</p>
                </div>
            </div>
        `;
        document.getElementById('save-btn').addEventListener('click', () => {
            const mood = document.getElementById('mood-select').value;
            const entry = document.getElementById('journal-entry').value.trim();
            if (mood && entry) {
                moodEntries.push({ mood, entry, date: new Date().toLocaleDateString() });
                showMessageBox('Entry saved successfully!');
                document.getElementById('mood-select').value = '';
                document.getElementById('journal-entry').value = '';
            } else {
                showMessageBox('Please select a mood and write an entry.');
            }
        });
        document.getElementById('analyze-btn').addEventListener('click', () => {
            const analysisOutput = document.getElementById('analysis-output');
            if (moodEntries.length === 0) {
                analysisOutput.innerHTML = `<p class="text-gray-400">${getTranslation('entriesPlaceholder')}</p>`;
                return;
            }
            const moodCounts = moodEntries.reduce((acc, entry) => {
                acc[entry.mood] = (acc[entry.mood] || 0) + 1;
                return acc;
            }, {});
            const totalEntries = moodEntries.length;
            let analysisText = '';
            for (const mood in moodCounts) {
                const percentage = ((moodCounts[mood] / totalEntries) * 100).toFixed(0);
                analysisText += `<p class="text-gray-700 font-semibold">${getTranslation('mood' + mood.charAt(0).toUpperCase() + mood.slice(1))}: ${percentage}%</p>`;
            }
            analysisOutput.innerHTML = `<h2 class="text-lg font-bold mb-2">${getTranslation('moodAnalysis')}</h2>${analysisText}`;
        });
    };

    const renderFoodRecipesPage = () => {
        appContainer.innerHTML = `
            <h1 class="text-3xl font-bold mb-6 text-center text-gray-900">${getTranslation('foodRecipes')}</h1>
            <div class="w-full max-w-2xl flex flex-col md:flex-row items-center gap-4 mb-6">
                <input type="text" id="recipeInput" class="flex-1 w-full p-4 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="${getTranslation('inputPlaceholderRecipes')}">
                <div class="flex gap-2 w-full md:w-auto">
                    <button id="getRecipeBtn" class="flex-1 md:flex-auto px-6 py-4 bg-orange-500 text-white font-bold rounded-lg shadow-md hover:bg-orange-600 transition-colors">
                        ${getTranslation('getRecipe')}
                    </button>
                    <button id="mic-btn" class="px-4 py-4 bg-gray-200 text-gray-600 rounded-lg hover:bg-gray-300 transition-colors">
                        <i class="fas fa-microphone"></i>
                    </button>
                </div>
            </div>
            <div id="recipeOutput" class="output-box-container w-full max-w-2xl mt-4 relative">
                <div class="output-box">
                    <p class="text-gray-400">${getTranslation('yourTipHere')}</p>
                </div>
                <div class="output-box-actions">
                    <button id="speak-btn" class="p-2 bg-gray-200 text-gray-600 rounded-full hover:bg-gray-300 transition-colors">
                        <i class="fas fa-volume-up"></i>
                    </button>
                </div>
            </div>
        `;
        document.getElementById('getRecipeBtn').addEventListener('click', () => {
            const input = document.getElementById('recipeInput').value.trim();
            if (input) {
                getAiRecipeFromPrompt(input, 'recipeOutput');
            } else {
                showMessageBox(getTranslation('inputPlaceholderRecipes'));
            }
        });
        document.getElementById('mic-btn').addEventListener('click', (e) => toggleSpeechRecognition('recipeInput', e.currentTarget));
        document.getElementById('speak-btn').addEventListener('click', (e) => {
            const textToSpeak = document.getElementById('recipeOutput').textContent.trim();
            toggleSpeak(textToSpeak, e.currentTarget);
        });
    };

    const renderBodyPainMapPage = () => {
        appContainer.innerHTML = `
            <div class="w-full max-w-2xl flex flex-col items-center">
                <h1 class="text-3xl font-bold mb-4 text-center text-gray-900">${getTranslation('bodyPainMap')}</h1>
                <p class="text-gray-600 mb-4 text-center">${getTranslation('painMapTipInstructions')}</p>
                <div class="flex space-x-4 mb-4">
                    <button id="view-front-btn" class="px-4 py-2 bg-indigo-500 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-600 transition-colors">
                        ${getTranslation('viewFront')}
                    </button>
                    <button id="view-back-btn" class="px-4 py-2 bg-gray-300 text-gray-700 font-semibold rounded-lg shadow-md hover:bg-gray-400 transition-colors">
                        ${getTranslation('viewBack')}
                    </button>
                </div>
                <div id="pain-map-container" class="pain-map-container"></div>
                <div id="painOutput" class="output-box-container w-full mt-6 relative">
                    <div class="output-box">
                        <p class="text-gray-400">${getTranslation('genericPainTip')}</p>
                    </div>
                    <div class="output-box-actions">
                        <button id="speak-btn" class="p-2 bg-gray-200 text-gray-600 rounded-full hover:bg-gray-300 transition-colors">
                            <i class="fas fa-volume-up"></i>
                        </button>
                    </div>
                </div>
            </div>
        `;

        const renderPainMap = () => {
            const container = document.getElementById('pain-map-container');
            const svgContent = isFrontView ? `
                <svg viewBox="0 0 160 300" class="pain-map-svg w-full h-auto" xmlns="http://www.w3.org/2000/svg">
                    <!-- Front view SVG paths for different body parts -->
                    <g id="body-front" stroke="#333" fill="#aaa">
                        <path class="body-part" id="head-front" d="M80,10 A25,25 0 1,0 80,60" />
                        <path class="body-part" id="neck-front" d="M75,60 L75,70 L85,70 L85,60 Z" />
                        <path class="body-part" id="chest" d="M60,70 Q80,80 100,70 L100,105 Q80,115 60,105 Z" />
                        <path class="body-part" id="stomach" d="M60,105 Q80,115 100,105 L100,150 Q80,160 60,150 Z" />
                        <path class="body-part" id="arm-r-front" d="M100,70 Q115,100 110,130 Q105,160 100,190 Q90,210 95,220 Q90,230 100,240 Q105,250 100,260 Z" transform="scale(-1,1) translate(-160,0)"/>
                        <path class="body-part" id="arm-l-front" d="M100,70 Q115,100 110,130 Q105,160 100,190 Q90,210 95,220 Q90,230 100,240 Q105,250 100,260 Z"/>
                        <path class="body-part" id="hand-r-front" d="M100,260 Q105,265 105,270 Q100,275 95,270 L95,260 Z" transform="scale(-1,1) translate(-160,0)" />
                        <path class="body-part" id="hand-l-front" d="M100,260 Q105,265 105,270 Q100,275 95,270 L95,260 Z" />
                        <path class="body-part" id="waist-front" d="M60,150 Q80,160 100,150 L100,200 Q80,210 60,200 Z" />
                        <path class="body-part" id="thigh-r-front" d="M100,200 L100,240 Q95,250 90,240 Q85,250 80,240 Q75,250 70,240 Q65,250 60,240 L60,200 Z" transform="scale(-1,1) translate(-160,0)" />
                        <path class="body-part" id="thigh-l-front" d="M100,200 L100,240 Q95,250 90,240 Q85,250 80,240 Q75,250 70,240 Q65,250 60,240 L60,200 Z" />
                        <path class="body-part" id="knee-r-front" d="M90,240 Q95,245 95,250 Q90,255 85,250 L85,245 Z" transform="scale(-1,1) translate(-160,0)" />
                        <path class="body-part" id="knee-l-front" d="M90,240 Q95,245 95,250 Q90,255 85,250 L85,245 Z" />
                        <path class="body-part" id="shin-r-front" d="M85,250 L85,280 Q80,285 75,280 Q70,285 65,280 Q60,285 55,280 L55,250 Z" transform="scale(-1,1) translate(-160,0)" />
                        <path class="body-part" id="shin-l-front" d="M85,250 L85,280 Q80,285 75,280 Q70,285 65,280 Q60,285 55,280 L55,250 Z" />
                        <path class="body-part" id="ankle-r-front" d="M75,280 Q80,285 80,290 L75,295 Q70,290 70,285 Z" transform="scale(-1,1) translate(-160,0)" />
                        <path class="body-part" id="ankle-l-front" d="M75,280 Q80,285 80,290 L75,295 Q70,290 70,285 Z" />
                        <path class="body-part" id="foot-r-front" d="M80,295 Q75,300 70,295 Q65,290 60,295 Q55,300 50,295 L50,290 Z" transform="scale(-1,1) translate(-160,0)" />
                        <path class="body-part" id="foot-l-front" d="M80,295 Q75,300 70,295 Q65,290 60,295 Q55,300 50,295 L50,290 Z" />
                    </g>
                </svg>
            ` : `
                <svg viewBox="0 0 160 300" class="pain-map-svg w-full h-auto" xmlns="http://www.w3.org/2000/svg">
                    <!-- Back view SVG paths for different body parts -->
                    <g id="body-back" stroke="#333" fill="#aaa">
                        <path class="body-part" id="head-back" d="M80,10 A25,25 0 1,0 80,60" />
                        <path class="body-part" id="neck-back" d="M75,60 L75,70 L85,70 L85,60 Z" />
                        <path class="body-part" id="back" d="M60,70 Q80,80 100,70 L100,150 Q80,160 60,150 Z" />
                        <path class="body-part" id="buttocks" d="M60,150 L60,180 Q80,190 100,180 L100,150 Z" />
                        <path class="body-part" id="shoulder-r-back" d="M100,70 Q115,100 110,130 Q105,160 100,190 Q90,210 95,220 Q90,230 100,240 Q105,250 100,260 Z" transform="scale(-1,1) translate(-160,0)" />
                        <path class="body-part" id="shoulder-l-back" d="M100,70 Q115,100 110,130 Q105,160 100,190 Q90,210 95,220 Q90,230 100,240 Q105,250 100,260 Z" />
                        <path class="body-part" id="arm-r-back" d="M100,70 Q115,100 110,130 Q105,160 100,190 Q90,210 95,220 Q90,230 100,240 Q105,250 100,260 Z" transform="scale(-1,1) translate(-160,0)" />
                        <path class="body-part" id="arm-l-back" d="M100,70 Q115,100 110,130 Q105,160 100,190 Q90,210 95,220 Q90,230 100,240 Q105,250 100,260 Z" />
                        <path class="body-part" id="elbow-r-back" d="M100,220 L110,210 L115,220 Q110,230 105,225 Z" transform="scale(-1,1) translate(-160,0)" />
                        <path class="body-part" id="elbow-l-back" d="M100,220 L110,210 L115,220 Q110,230 105,225 Z" />
                        <path class="body-part" id="forearm-r-back" d="M100,240 L105,250 Q100,255 95,250 Q90,255 85,250 L85,240 Z" transform="scale(-1,1) translate(-160,0)" />
                        <path class="body-part" id="forearm-l-back" d="M100,240 L105,250 Q100,255 95,250 Q90,255 85,250 L85,240 Z" />
                        <path class="body-part" id="hand-r-back" d="M100,260 Q105,265 105,270 Q100,275 95,270 L95,260 Z" transform="scale(-1,1) translate(-160,0)" />
                        <path class="body-part" id="hand-l-back" d="M100,260 Q105,265 105,270 Q100,275 95,270 L95,260 Z" />
                        <path class="body-part" id="waist-back" d="M60,150 L60,180 Q80,190 100,180 L100,150 Z" />
                        <path class="body-part" id="thigh-r-back" d="M100,180 L100,220 Q95,230 90,220 Q85,230 80,220 Q75,230 70,220 Q65,230 60,220 L60,180 Z" transform="scale(-1,1) translate(-160,0)" />
                        <path class="body-part" id="thigh-l-back" d="M100,180 L100,220 Q95,230 90,220 Q85,230 80,220 Q75,230 70,220 Q65,230 60,220 L60,180 Z" />
                        <path class="body-part" id="knee-r-back" d="M90,220 Q95,225 95,230 Q90,235 85,230 L85,225 Z" transform="scale(-1,1) translate(-160,0)" />
                        <path class="body-part" id="knee-l-back" d="M90,220 Q95,225 95,230 Q90,235 85,230 L85,225 Z" />
                        <path class="body-part" id="calf-r-back" d="M85,230 L85,270 Q80,275 75,270 Q70,275 65,270 Q60,275 55,270 L55,230 Z" transform="scale(-1,1) translate(-160,0)" />
                        <path class="body-part" id="calf-l-back" d="M85,230 L85,270 Q80,275 75,270 Q70,275 65,270 Q60,275 55,270 L55,230 Z" />
                        <path class="body-part" id="ankle-r-back" d="M75,270 Q80,275 80,280 L75,285 Q70,280 70,275 Z" transform="scale(-1,1) translate(-160,0)" />
                        <path class="body-part" id="ankle-l-back" d="M75,270 Q80,275 80,280 L75,285 Q70,280 70,275 Z" />
                        <path class="body-part" id="foot-r-back" d="M80,285 Q75,290 70,285 Q65,280 60,285 Q55,290 50,285 L50,280 Z" transform="scale(-1,1) translate(-160,0)" />
                        <path class="body-part" id="foot-l-back" d="M80,285 Q75,290 70,285 Q65,280 60,285 Q55,290 50,285 L50,280 Z" />
                    </g>
                </svg>
            `;
            container.innerHTML = svgContent;

            const updateMapState = () => {
                document.querySelectorAll('.pain-map-svg .body-part').forEach(part => {
                    const partId = part.id;
                    if (painMapState[partId]) {
                        part.classList.add('pain');
                    } else {
                        part.classList.remove('pain');
                    }
                });
            };

            const handlePainMapClick = (event) => {
                const part = event.target.closest('.body-part');
                if (part) {
                    const partId = part.id;
                    painMapState[partId] = !painMapState[partId];
                    updateMapState();

                    const partName = painMapPartNames[partId][currentLang] || partId;
                    const prompt = `${getTranslation('painPromptPrefix')} ${partName}`;
                    getAiTipFromPrompt(prompt, 'painOutput');
                }
            };
            container.addEventListener('click', handlePainMapClick);
            updateMapState();
        };

        const toggleView = (isFront) => {
            isFrontView = isFront;
            const frontBtn = document.getElementById('view-front-btn');
            const backBtn = document.getElementById('view-back-btn');
            if (isFrontView) {
                frontBtn.classList.remove('bg-gray-300', 'text-gray-700');
                frontBtn.classList.add('bg-indigo-500', 'text-white');
                backBtn.classList.remove('bg-indigo-500', 'text-white');
                backBtn.classList.add('bg-gray-300', 'text-gray-700');
            } else {
                backBtn.classList.remove('bg-gray-300', 'text-gray-700');
                backBtn.classList.add('bg-indigo-500', 'text-white');
                frontBtn.classList.remove('bg-indigo-500', 'text-white');
                frontBtn.classList.add('bg-gray-300', 'text-gray-700');
            }
            renderPainMap();
        };

        document.getElementById('view-front-btn').addEventListener('click', () => toggleView(true));
        document.getElementById('view-back-btn').addEventListener('click', () => toggleView(false));
        document.getElementById('speak-btn').addEventListener('click', (e) => {
            const textToSpeak = document.getElementById('painOutput').textContent.trim();
            toggleSpeak(textToSpeak, e.currentTarget);
        });

        renderPainMap();
    };

    const renderFirstAidPage = () => {
        appContainer.innerHTML = `
            <div class="w-full max-w-2xl flex flex-col items-center p-6 bg-white rounded-2xl shadow-xl transition-all duration-300">
                <h1 class="text-3xl font-bold mb-4 text-center text-gray-900">${getTranslation('firstAid')}</h1>
                <p class="text-gray-600 mb-6 text-center">${getTranslation('firstAidPrompt')}</p>
                <div class="w-full space-y-4">
                    <button id="emergencyTipBtn" class="w-full py-4 px-6 bg-red-600 text-white font-bold rounded-xl shadow-lg hover:bg-red-700 transition-colors">
                        ${getTranslation('emergencyTip')}
                    </button>
                    <div id="emergency-contacts" class="w-full">
                        <h2 class="text-xl font-bold mb-2">${getTranslation('emergencyContacts')}</h2>
                        <ul id="contacts-list" class="space-y-2">
                            ${emergencyContacts.length === 0 ? `<li class="text-gray-400">${getTranslation('noContacts')}</li>` : ''}
                        </ul>
                        <div class="flex gap-2 mt-4">
                            <input type="text" id="new-contact-name" class="flex-1 p-3 border border-gray-300 rounded-lg" placeholder="Name">
                            <input type="tel" id="new-contact-number" class="flex-1 p-3 border border-gray-300 rounded-lg" placeholder="Phone Number">
                            <button id="add-contact-btn" class="p-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div id="first-aid-output" class="output-box w-full mt-6">
                    <p class="text-gray-400">${getTranslation('yourTipHere')}</p>
                </div>
            </div>
        `;

        const renderContacts = () => {
            const list = document.getElementById('contacts-list');
            list.innerHTML = emergencyContacts.length === 0 ? `<li class="text-gray-400">${getTranslation('noContacts')}</li>` : '';
            emergencyContacts.forEach(contact => {
                const li = document.createElement('li');
                li.className = 'flex items-center justify-between p-3 bg-gray-100 rounded-lg';
                li.innerHTML = `
                    <span>${contact.name}: ${contact.number}</span>
                    <a href="tel:${contact.number}" class="text-green-500 hover:text-green-600">
                        <i class="fas fa-phone"></i>
                    </a>
                `;
                list.appendChild(li);
            });
        };

        document.getElementById('emergencyTipBtn').addEventListener('click', () => {
            const prompt = `Provide immediate first aid tips for a medical emergency.`;
            getAiTipFromPrompt(prompt, 'first-aid-output');
        });

        document.getElementById('add-contact-btn').addEventListener('click', () => {
            const name = document.getElementById('new-contact-name').value.trim();
            const number = document.getElementById('new-contact-number').value.trim();
            if (name && number) {
                emergencyContacts.push({ name, number });
                renderContacts();
                document.getElementById('new-contact-name').value = '';
                document.getElementById('new-contact-number').value = '';
            } else {
                showMessageBox('Please enter both name and number.');
            }
        });

        renderContacts();
    };

    // Initial render
    window.onload = render;

    // Make navigateTo globally accessible for onclick attributes
    window.navigateTo = navigateTo;
    window.closeMessageBox = closeMessageBox;
    window.toggleLanguage = toggleLanguage;
</script>

</body>
</html>
